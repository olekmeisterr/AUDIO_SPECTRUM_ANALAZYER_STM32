#include "signal_filter.h"
#include <arm_math.h>

#define FILTER_TAPS 141 //Liczba współczynników filtra
#define BLOCK_SIZE 32 //Liczba próbek na blok

// Współczynniki filtra
static const float32_t filter_coeffs[FILTER_TAPS] = {- -0.028747226412780952503611686665863089729,
		-0.001319638444175764676116746620948561031,
		-0.001296911736523228891523884520609044557,
		-0.001237036510494834940995789729356602038,
		-0.00113975260592780419481584441854238321 ,
		-0.001003670179547100837699757924781351903,
		-0.000831157232488082290886022285292256129,
		-0.000619359724644517883884731190846650861,
		-0.000372942001262472515917684168229584429,
		-0.000091641389110069983040332552981510617,
		 0.000220630580718146482787841988759680589,
		 0.000564445444560692194228834761560165134,
		 0.00093368264406671589057673532607850575 ,
		 0.001327664501990540816406261015458767361,
		 0.00173918886977249341312112829172065176 ,
		 0.002165818935587905669226671534488559701,
		 0.002599389852531711585237328421271740808,
		 0.003041059305182069755907336983113964379,
		 0.003479438925823901546108274374091706704,
		 0.003909190964595873549192184270850702887,
		 0.00432561293529845278249545970084000146 ,
		 0.004723096404704727607759551233357342426,
		 0.005087704141487185867387399440531225991,
		 0.005426542151481255835121508823704061797,
		 0.005720977209818537898011747699911211384,
		 0.005968252941779509691822003247807515436,
		 0.006161295601474008412634653097939008148,
		 0.006298548463458657903357718055303848814,
		 0.006369234071232742454282682587063391111,
		 0.006373223801715785681587522759627972846,
		 0.006299686954556054513387763904574967455,
		 0.006150012287013613236641429438122941065,
		 0.005913814123392585088423434314108817489,
		 0.005596475645858343429817072234300212585,
		 0.005184546427004273032312919866626543808,
		 0.00468559910918979732191713694078316621 ,
		 0.004083797139414675238244800681286506006,
		 0.003394490847371864090248338996502752707,
		 0.002592279437985939901517573602518496045,
		 0.0017316410906090011143088069900386472  ,
		 0.000794123720630651383500797635406343034,
		-0.000280991707974561808706243093425314328,
		-0.001400411198360347522079427662333728222,
		-0.002614623147928520942306906960084234015,
		-0.003890380669912285940825746877180790761,
		-0.005239532781248467697976511914248476387,
		-0.00664015394809282146620921238877599535 ,
		-0.008099127297515863743715414102553040721,
		-0.009595097862046698261595523149480868597,
		-0.011128997692228512206291668462654342875,
		-0.012682808204921090788896975709576508962,
		-0.014255269107404707623620865319935546722,
		-0.01582846602856281120752512947547074873 ,
		-0.017399312972861749604369663302350090817,
		-0.018950449557682817747217285386795992963,
		-0.020475681630082290946015532995261310134,
		-0.021959662707153944360971564719875459559,
		-0.023398847610752417786050827430699428078,
		-0.024776601517684529452090202994440915063,
		-0.026085086230257310130342673915038176347,
		-0.027317848403721201044902500143507495522,
		-0.028461414560530862161158438539132475853,
		-0.029500419456826295488971467761984968092,
		-0.030453879889125561042373391273940796964,
		-0.031284916708024766707207930949152796529,
		-0.032002249683040995265059791563544422388,
		-0.032591867742965414944666946439610910602,
		-0.033059936912410749221269412601031945087,
		-0.033393269482916015933327003040176350623,
		-0.033598735023659384579808317994320532307,
		 0.966335309430565780886013271810952574015,
		-0.033598735023659384579808317994320532307,
		-0.033393269482916015933327003040176350623,
		-0.033059936912410749221269412601031945087,
		-0.032591867742965414944666946439610910602,
		-0.032002249683040995265059791563544422388,
		-0.031284916708024766707207930949152796529,
		-0.030453879889125561042373391273940796964,
		-0.029500419456826295488971467761984968092,
		-0.028461414560530862161158438539132475853,
		-0.027317848403721201044902500143507495522,
		-0.026085086230257310130342673915038176347,
		-0.024776601517684529452090202994440915063,
		-0.023398847610752417786050827430699428078,
		-0.021959662707153944360971564719875459559,
		-0.020475681630082290946015532995261310134,
		-0.018950449557682817747217285386795992963,
		-0.017399312972861749604369663302350090817,
		-0.01582846602856281120752512947547074873 ,
		-0.014255269107404707623620865319935546722,
		-0.012682808204921090788896975709576508962,
		-0.011128997692228512206291668462654342875,
		-0.009595097862046698261595523149480868597,
		-0.008099127297515863743715414102553040721,
		-0.00664015394809282146620921238877599535 ,
		-0.005239532781248467697976511914248476387,
		-0.003890380669912285940825746877180790761,
		-0.002614623147928520942306906960084234015,
		-0.001400411198360347522079427662333728222,
		-0.000280991707974561808706243093425314328,
		 0.000794123720630651383500797635406343034,
		 0.0017316410906090011143088069900386472  ,
		 0.002592279437985939901517573602518496045,
		 0.003394490847371864090248338996502752707,
		 0.004083797139414675238244800681286506006,
		 0.00468559910918979732191713694078316621 ,
		 0.005184546427004273032312919866626543808,
		 0.005596475645858343429817072234300212585,
		 0.005913814123392585088423434314108817489,
		 0.006150012287013613236641429438122941065,
		 0.006299686954556054513387763904574967455,
		 0.006373223801715785681587522759627972846,
		 0.006369234071232742454282682587063391111,
		 0.006298548463458657903357718055303848814,
		 0.006161295601474008412634653097939008148,
		 0.005968252941779509691822003247807515436,
		 0.005720977209818537898011747699911211384,
		 0.005426542151481255835121508823704061797,
		 0.005087704141487185867387399440531225991,
		 0.004723096404704727607759551233357342426,
		 0.00432561293529845278249545970084000146 ,
		 0.003909190964595873549192184270850702887,
		 0.003479438925823901546108274374091706704,
		 0.003041059305182069755907336983113964379,
		 0.002599389852531711585237328421271740808,
		 0.002165818935587905669226671534488559701,
		 0.00173918886977249341312112829172065176 ,
		 0.001327664501990540816406261015458767361,
		 0.00093368264406671589057673532607850575 ,
		 0.000564445444560692194228834761560165134,
		 0.000220630580718146482787841988759680589,
		-0.000091641389110069983040332552981510617,
		-0.000372942001262472515917684168229584429,
		-0.000619359724644517883884731190846650861,
		-0.000831157232488082290886022285292256129,
		-0.001003670179547100837699757924781351903,
		-0.00113975260592780419481584441854238321 ,
		-0.001237036510494834940995789729356602038,
		-0.001296911736523228891523884520609044557,
		-0.001319638444175764676116746620948561031,
		-0.028747226412780952503611686665863089729,

};

// Struktura filtra FIR
static arm_fir_instance_f32 fir_instance;
// Bufor stanu filtra
static float32_t filter_state[FILTER_TAPS + BLOCK_SIZE - 1];

// Inicjalizacja filtra FIR
void fir_filter_init(void) {
    arm_fir_init_f32(&fir_instance, FILTER_TAPS, filter_coeffs, filter_state, BLOCK_SIZE);
}

// Funkcja przetwarzania sygnału przez filtr FIR
void fir_filter_process(float32_t *input, float32_t *output, uint32_t block_size) {
    arm_fir_f32(&fir_instance, input, output, block_size);
}
